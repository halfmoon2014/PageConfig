<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        #tools {
            margin: 0 20px;
            float: left;
            width: 200px;
            height: 800px;
            border: 1px solid #000;
        }

        #workspace {
            position: relative;
            margin: 0 20px;
            float: left;
            width: 1024px;
            height: 800px;
            border: 1px solid #000;
        }
        #titles{    
             margin: 0 20px;     
            height: 100px;
            border: 1px solid #000;
        }

        /*div {
            display: flex;
            flex-direction: column;
            align-items: center
        }*/

        /*p {
            display: flex;
            flex-direction: column;
            align-items: center
        }*/

         

        .p3 {
            width: 110px;
            background-color: rgb(133, 88, 29);
            margin: 5px 0;          
        }
        #abid1{
            position:absolute;top:30px;left:30px;
        }
         #div2_1{
            width:200px;height:30px;background-color:rebeccapurple; margin: 5px 0;
        }
       
    </style>
</head>
<body>
    <div id="worker">
        <div id="titles">titles</div>
        <div id="tools">
            <!-- 在h5中，如果想拖拽元素，就必须为元素添加draggable="true"。图片和超链接默认就可以拖拽 -->
            <p id="pe3" class="p3">3</p>           
            <div id="div2_1">
            </div>
            <label id="label1">label1</label>
        </div>
        <div id="workspace">
            <p id="pe3333" class="p3">3</p>    
            <div draggable="true" id="abid1">test</div>
        </div>


        <input type="text" id="text5" style="width:80px;" draggable="true" value="5" />
        <input type="text" id="text6" style="width:80px;" draggable="true" value="6" />
        <table draggable="true" id="t1">
            <tr><td>123</td><td>123</td><td>123</td></tr>
            <tr><td>123</td><td>123</td><td>123</td></tr>
            <tr><td>123</td><td>123</td><td>123</td></tr>
        </table>
    </div>
    <script type="text/javascript">
        window.onload = function () {
            SetDragable.initMoveObj(document.getElementById("workspace"));
            SetDragable.initDrgObj(document.getElementById("pe3"));
            SetDragable.initDrgObj(document.getElementById("div2_1"));
            SetDragable.initDrgObj(document.getElementById("label1"));
        };
        var SetDragable = (function () {
            /* 拖拽元素支持的事件
                 ondrag 应用于拖拽元素，整个拖拽过程都会调用
                 ondragstart 应用于拖拽元素，当拖拽开始时调用
                 ondragleave 应用于拖拽元素，当鼠标离开拖拽元素是调用
                 ondragend 应用于拖拽元素，当拖拽结束时调用

                 目标元素支持的事件
                 ondragenter 应用于目标元素，当拖拽元素进入时调用
                 ondragover 应用于目标元素，当停留在目标元素上时调用
                 ondrop 应用于目标元素，当在目标元素上松开鼠标时调用
                 ondragleave 应用于目标元素，当鼠标离开目标元素时调用
             */

            var dragstart = function (e) {
                /*通过dataTransfer来实现数据的存储与获取
                    setData(format, data)
                    format: 数据的类型： text/html  text/uri-list
                    Data: 数据： 一般来说是字符串值
                */
                // e.dataTransfer.setData("Text", e.target.id);
                e.target.style.opacity = 0.5             
                e.dataTransfer.setData("text", e.target.id );              
                console.log(e.target.id + "ondragstart")
            }

            var dragend = function (e) {
                e.target.style.opacity = 1;            
                console.log(e.target.id + "ondragend")
            }

            /*浏览器默认会阻止ondrop事件：我们必须在ondrapover中阻止默认行为*/
            var dragover = function (e) {
                console.log(e.target.id + "ondragover")
                e.preventDefault();
            }

            var drop = function (e) {
                /*通过e.dataTransfer.setData存储的数据，只能在drop事件中获取*/
                var data = e.dataTransfer.getData("text")
                //e.target.appendChild(document.getElementById(data));
                var sourceNode = document.getElementById(data); // 获得被克隆的节点对象
                var clonedNode = sourceNode.cloneNode(true); // 克隆节点
                clonedNode.style.opacity = 1
                var newid=uuid();
                clonedNode.setAttribute("id", newid); // 修改一下id 值，避免id 重复
                clonedNode.style.position = "absolute";
                clonedNode.style.top = (e.offsetY- event.target.offsetTop)+"px"
                clonedNode.style.left = (e.offsetX - event.target.offsetLeft) + "px"
                e.target.appendChild(clonedNode);                
                console.log(e.target.id + "ondrop")
            }
            var initMoveObj = function (moveObj) {
                moveObj.addEventListener("dragover", dragover, true);
                moveObj.addEventListener("drop", drop, true);
            }

            var initDrgObj = function (drgObj) {
                drgObj.draggable = true;
                drgObj.style.cursor = "move";
                //监听拖动事件
                drgObj.addEventListener("dragstart", dragstart, true);
                drgObj.addEventListener("dragend", dragend, true);
            }
            return {
                initMoveObj: initMoveObj,
                initDrgObj: initDrgObj
            };
        })();


 
        //document.ondragstart = function (e) {
        //    /*通过dataTransfer来实现数据的存储与获取
        //        setData(format, data)
        //        format: 数据的类型： text/html  text/uri-list
        //        Data: 数据： 一般来说是字符串值
        //    */
        //    // e.dataTransfer.setData("Text", e.target.id);
        //    e.target.style.opacity = 0.5
        //    e.dataTransfer.setData("text", e.target.id);
        //    //let off = { x: e.x - getLeft(e.target), y: e.y - getTop(e.target) };
        //    console.log(e.target.id + "ondragstart")
        //}

        //document.ondragend = function (e) {
        //    e.target.style.opacity = 1;
        //    //let off = moveObj.dragOff;
        //    //moveObj.style.top = e.y - off.y + "px";
        //    //moveObj.style.left = e.x - off.x + "px";
        //    console.log(e.target.id + "ondragend")
        //}

        ///*浏览器默认会阻止ondrop事件：我们必须在ondrapover中阻止默认行为*/
        //document.ondragover = function (e) {
        //    console.log(e.target.id + "ondragover")
        //    e.preventDefault();
        //}

        //document.ondrop = function (e) {
        //    /*通过e.dataTransfer.setData存储的数据，只能在drop事件中获取*/
        //    var data = e.dataTransfer.getData("text");
        //    //e.target.appendChild(document.getElementById(data));

        //    var sourceNode = document.getElementById(data); // 获得被克隆的节点对象
        //    var clonedNode = sourceNode.cloneNode(true); // 克隆节点
        //    clonedNode.style.opacity = 1
        //    clonedNode.setAttribute("id", uuid()); // 修改一下id 值，避免id 重复
        //    clonedNode.style.position = "absolute";
        //    clonedNode.style.top = "10px;"
        //    clonedNode.style.left = "10px;"
        //    e.target.appendChild(clonedNode);

        //    console.log(e.target.id + "ondrop")
        //}

        function getTop(e) {
            var offset = e.offsetTop;
            if (e.offsetParent != null) offset += getTop(e.offsetParent);
            return offset;
        }
        //获取元素的横坐标,距离文档左边的宽度
        function getLeft(e) {
            var offset = e.offsetLeft;
            if (e.offsetParent != null) offset += getLeft(e.offsetParent);
            return offset;
        }

        function uuid() {
            var s = [];
            var hexDigits = "0123456789abcdef";
            for (var i = 0; i < 36; i++) {
                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
            }
            s[14] = "4";  // bits 12-15 of the time_hi_and_version field to 0010
            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01
            s[8] = s[13] = s[18] = s[23] = "-";

            var uuid = s.join("");
            return uuid;
        }
    </script>
</body>
</html> 